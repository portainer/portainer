<rd-header id="view-top">
  <rd-header-title title-text="Helm">
    <a data-toggle="tooltip" title="Refresh" ui-sref="kubernetes.helms" ui-sref-opts="{reload: true}">
      <i class="fa fa-sync" aria-hidden="true"></i>
    </a>
  </rd-header-title>
  <rd-header-content>Charts</rd-header-content>
</rd-header>

<information-panel title-text="Information" ng-if="!state.selectedTemplate">
  <span class="small text-muted">
    <p>
      <i class="fa fa-exclamation-circle orange-icon" aria-hidden="true" style="margin-right: 2px;"></i>
      This is a first version for Helm charts, for more information see this <a href="#">blog post.</a>
    </p>
  </span>
</information-panel>

<div class="row">
  <!-- helmchart-form -->
  <div class="col-sm-12" ng-if="state.selectedTemplate">
    <rd-widget>
      <rd-widget-custom-header icon="state.selectedTemplateIcon" title-text="state.selectedTemmplateName"></rd-widget-custom-header>
      <rd-widget-body classes="padding">
        <form class="form-horizontal">
          <!-- description -->
          <div>
            <div class="col-sm-12 form-section-title">
              Description
            </div>
            <div class="form-group">
              <div class="col-sm-12">
                <div class="template-note" ng-bind-html="state.selectedTemplateNote"></div>
              </div>
            </div>
          </div>
          <!-- !description -->
          <div class="col-sm-12 form-section-title">
            Configuration
          </div>
          <!-- namespace-input -->
          <div class="form-group">
            <label for="resource-pool-selector" class="col-sm-2 control-label text-left">Namespace</label>
            <div class="col-sm-10">
              <select
                class="form-control"
                id="resource-pool-selector"
                ng-model="state.ResourcePool"
                ng-options="resourcePool.Namespace.Name for resourcePool in state.resourcePools"
                ng-change=""
                ng-disabled="ctrl.state.isEdit"
              ></select>
            </div>
          </div>
          <div class="form-group" ng-if="!state.ResourcePool">
            <div class="col-sm-12 small text-danger">
              <i class="fa fa-exclamation-circle red-icon" aria-hidden="true" style="margin-right: 2px;"></i>
              This namespace has exhausted its resource capacity and you will not be able to deploy the application. Contact your administrator to expand the capacity of the
              namespace.
            </div>
          </div>
          <div class="form-group" ng-if="!state.ResourcePool">
            <div class="col-sm-12 small text-muted">
              <i class="fa fa-exclamation-circle orange-icon" aria-hidden="true" style="margin-right: 2px;"></i>
              You do not have access to any namespace. Contact your administrator to get access to a namespace.
            </div>
          </div>
          <!-- !namespace-input -->
          <!-- name-input -->
          <div class="form-group">
            <label for="container_name" class="col-sm-2 control-label text-left">Name</label>
            <div class="col-sm-10">
              <input type="text" name="container_name" class="form-control" ng-model="formValues.appname" placeholder="e.g. my-app" />
            </div>
          </div>
          <!-- !name-input -->
          <div class="form-group">
            <div class="col-sm-12">
              <a class="small interactive" ng-if="!state.showCustomValues" ng-click="state.showCustomValues = true;">
                <i class="fa fa-plus space-right" aria-hidden="true"></i> Show custom values
              </a>
              <a class="small interactive" ng-if="state.showCustomValues" ng-click="state.showCustomValues = false;">
                <i class="fa fa-minus space-right" aria-hidden="true"></i> Hide custom values
              </a>
            </div>
          </div>
          <!-- values override -->
          <div ng-if="state.showCustomValues">
            <!-- web-editor -->
            <div>
              <div class="col-sm-12 form-section-title">
                Web editor
              </div>
              <div class="form-group">
                <span class="col-sm-12 text-muted small">
                  You can get more information about Kubernetes file format in the
                  <a href="https://helm.sh/docs/chart_template_guide/values_files/" target="_blank">official documentation</a>.
                </span>
                <div class="col-sm-12" ng-if="state.editorYamlValidationError"
                  ><span class="text-danger small">{{ state.editorYamlValidationError }}</span></div
                >
              </div>
              <div class="form-group">
                <div class="col-sm-12">
                  <!--                   <kubernetes-yaml-inspector key="application-yaml" data="state.values"> </kubernetes-yaml-inspector> -->
                  <code-editor
                    identifier="stack-creation-editor"
                    placeholder="# Define or paste the content of your values yaml file here"
                    yml="true"
                    on-change="(editorUpdate)"
                    value="state.values"
                  ></code-editor>
                </div>
              </div>
            </div>
            <!-- !web-editor -->
          </div>
          <!-- !values override -->
          <!-- helm actions -->
          <div class="col-sm-12 form-section-title">
            Actions
          </div>
          <div class="form-group">
            <div class="col-sm-12">
              <button type="button" class="btn btn-primary btn-sm" ng-disabled="state.resourcePool" ng-click="installHelmchart()" button-spinner="state.actionInProgress">
                <span ng-hide="state.actionInProgress">Install</span>
                <span ng-show="state.actionInProgress">Helm installing in progress...</span>
              </button>
              <button type="button" class="btn btn-sm btn-default" ng-click="unselectTemplate(state.selectedTemplate)">Hide</button>
              <span class="text-danger" ng-if="state.formValidationError" style="margin-left: 5px;">{{ state.formValidationError }}</span>
            </div>
          </div>
          <!-- !helm actions -->
        </form>
      </rd-widget-body>
    </rd-widget>
  </div>
  <!-- helmchart-form -->
</div>

<!-- Helm Charts Component -->
<div class="row">
  <div class="col-sm-12">
    <helm-list title-text="Charts" title-icon="fa-cog" templates="templates" table-key="templates" select-action="selectHelmChart"></helm-list>
  </div>
</div>
<!-- !Helm Charts Component -->
